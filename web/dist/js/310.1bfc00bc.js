"use strict";(self["webpackChunkvue2router"]=self["webpackChunkvue2router"]||[]).push([[310,285],{2804:function(t,e,a){a.d(e,{A:function(){return f}});var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"dialog",attrs:{id:"comment"+t.data.id},on:{click:function(e){return t.setChosenMargin(t.data.id)}}},[e("div",{staticClass:"info"},[e("span",[t._v("注释"+t._s(t.data.id+1))]),e("span",[t._v("位置"+t._s(t.data.position))]),e("margin-type",{attrs:{type:t.type},on:{displaySelectionPanel:function(e){return t.displaySelectionPanel()}}},[t._v(t._s(t.type))])],1),e("textarea",{attrs:{type:"text",disabled:"disabled"},domProps:{value:t.data.content}}),e("div",{staticClass:"buttons"},[e("button",{staticClass:"edit",on:{click:function(e){return t.edit(e,t.data.id)}}},[t._v("编辑")]),e("button",{staticClass:"delete",on:{click:function(e){return t.deleteComments(t.data.id)}}},[t._v("删除")]),e("a",{staticClass:"dialog-content",attrs:{href:this.link}},[t._v("跳转")])])])},s=[],i=function(){var t=this,e=t._self._c;return e("div",{ref:"tag",staticClass:"tag"},[e("span",[t._v(t._s(t.type))]),e("div",{staticClass:"answer"},[e("button",{style:"display:"+t.hidden,on:{click:t.addAnswer}},[t._v("查看/添加"+t._s(t.answer))])])])},o=[],l={props:{type:{type:String,required:!0},hide:{type:Boolean,required:!1,default:!0}},mounted(){console.log(this.type),"推测"===this.type?(this.$refs.tag.classList.add("inference"),this.answer="关联"):"疑点"===this.type?(this.$refs.tag.classList.add("question"),this.answer="解答"):"批注"===this.type&&(this.$refs.tag.classList.add("margin"),this.answer="关联")},data(){return{availableTypes:["推测","疑点","批注"],answer:"解答"}},methods:{addAnswer(){console.log("addAnswer"),this.$emit("displaySelectionPanel")}},computed:{hidden(){return"疑点"===this.type&&this.hide?"hidden":"none"}}},r=l,c=a(1656),m=(0,c.A)(r,i,o,!1,null,"6d5074f7",null),d=m.exports,h={props:{data:{type:Object,required:!0},type:{type:String},filename:{type:String}},components:{marginType:d},methods:{setChosenMargin(t){console.log("changed chosen margin"),this.$emit("setChosenMargin",t)},edit(t,e){t.currentTarget.parentNode.previousElementSibling.disabled=!t.currentTarget.parentNode.previousElementSibling.disabled,1==t.currentTarget.parentNode.previousElementSibling.disabled&&this.$emit("edit",e,t.currentTarget.parentNode.previousElementSibling.value)},deleteComments(t){this.$emit("deleteComments",t)},displaySelectionPanel(){console.log("display"),this.$emit("showSelectionModal")}},created(){""===this.filename||void 0===this.filename||null===this.filename?this.link=this.$route.path+"#dialog"+this.data.position:this.link="/search/"+this.filename+"#dialog"+this.data.position,console.log(this.link)},data(){return{link:""}}},p=h,u=(0,c.A)(p,n,s,!1,null,"7b32d8cd",null),f=u.exports},7285:function(t,e,a){a.r(e),a.d(e,{default:function(){return d}});var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"comments"},[e("div",{staticClass:"condition"},[e("div",{staticClass:"condition-wrapper"},[e("span",[t._v("剧情名称")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.filename,expression:"filename"}],attrs:{type:"radio"},domProps:{value:t.filenames[0]},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.filename=e.target.multiple?a:a[0]}}},[e("option",{attrs:{value:"all"}},[t._v("all")]),t._l(t.filenames,(function(a,n){return e("option",{key:n},[t._v(t._s(a))])}))],2)]),e("div",{staticClass:"condition-wrapper"},[e("span",[t._v("查找内容")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchText,expression:"searchText"}],attrs:{type:"text"},domProps:{value:t.searchText},on:{input:function(e){e.target.composing||(t.searchText=e.target.value)}}})]),e("div",{staticClass:"condition-wrapper"},[e("span",[t._v("批注类型")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.type,expression:"type"}],attrs:{type:"radio"},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.type=e.target.multiple?a:a[0]}}},[e("option",{attrs:{value:"all"}},[t._v("all")]),e("option",{attrs:{value:"疑点"}},[t._v("疑点")]),e("option",{attrs:{value:"推测"}},[t._v("推测")]),e("option",{attrs:{value:"批注"}},[t._v("批注")])])])]),e("br"),e("div",{staticClass:"comment-list"},[e("ul",[t._l(t.temp_comments,(function(a,n){return e("div",{key:n,ref:"margin",refInFor:!0,staticClass:"comment-wrapper",attrs:{id:"comment"+n},on:{click:function(e){return t.setChosenMargin(n,a.filename)}}},[e("span",[t._v(t._s(a.filename)+":")]),e("single-margin",{attrs:{data:a,type:a.type,filename:a.filename},on:{setChosenMargin:function(e){return t.setChosenMargin(n,a.filename)},edit:t.notAlter,deleteComments:t.notAlter}})],1)})),e("div",{staticStyle:{width:"100%",height:"400px"}})],2)]),e("div",{staticClass:"footer"},[e("button",{staticClass:"add",on:{click:t.add}},[t._v("添加")])])])},s=[],i=(a(3375),a(9225),a(3972),a(9209),a(5714),a(7561),a(6197),a(2804)),o=a(417),l={name:"BaseFriend",data(){return{type:"all",filename:"all",comments:[],filenames:[],temp_comments:[],chosen_margin:-1,chosen_filename:"",searchText:""}},components:{SingleMargin:i.A},async created(){const t=await(0,o.A)({url:"http://127.0.0.1:8000/get_all_comments"});this.comments=t.data,console.log(this.comments[0]),this.filenames=this.comments.map((t=>t.filename)),this.filenames=Array.from(new Set(this.filenames)),this.temp_comments=this.comments},methods:{add(){this.$emit("add",this.chosen_filename,this.temp_comments[this.chosen_margin].id)},notsupported(){console.log("not supported")},notAlter(){alert("you should not alter this")},setChosenMargin(t,e){console.log("this"),this.chosen_margin=t,this.chosen_filename=e},search(){"all"!=this.type&&(this.temp_comments=this.temp_comments.filter((t=>t.type===this.type)))},searchValidComments(){"all"!=this.filename?"all"!=this.type?this.temp_comments=this.comments.filter((t=>t.filename==this.filename&&t.type==this.type&&t.content.includes(this.searchText))):this.temp_comments=this.comments.filter((t=>t.filename==this.filename&&t.content.includes(this.searchText))):"all"!=this.type?this.temp_comments=this.comments.filter((t=>t.type==this.type&&t.content.includes(this.searchText))):this.temp_comments=this.comments.filter((t=>t.content.includes(this.searchText)))}},watch:{filename:{handler(){this.searchValidComments()}},type:{handler(){this.searchValidComments()}},searchText:{handler(){this.searchValidComments()}},chosen_margin(t,e){console.log(t),this.$refs.margin[t].classList.add("active-margin"),-1!=e&&this.$refs.margin[e].classList.remove("active-margin")}}},r=l,c=a(1656),m=(0,c.A)(r,n,s,!1,null,"525db3bf",null),d=m.exports},1310:function(t,e,a){a.r(e),a.d(e,{default:function(){return A}});var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"page"},[e("div",{staticClass:"buttons"},[e("b-button",{on:{click:function(e){return t.toggle()}}},[t._v("新建注释")]),e("button",{on:{click:function(e){return t.save()}}},[t._v("保存")]),e("span",[t._v("当前位置"+t._s(t.chosen_dialog))])],1),e("div",{staticClass:"document"},[e("div",{ref:"content",staticClass:"content"},[e("ul",t._l(t.text,(function(a){return e("single-dialog",{key:a.id,attrs:{data:a},on:{setChosenContent:t.setChosenContent}})})),1)]),e("div",{ref:"margin",staticClass:"margin"},[e("ul",t._l(t.comments,(function(a){return e("single-margin",{key:a.id,attrs:{data:a,type:a.type},on:{setChosenMargin:t.setChosenMargin,edit:t.edit,deleteComments:t.deleteComments,showSelectionModal:function(e){return t.showSelectionModal(a)}}})})),1)])]),e("b-modal",{ref:"modal",staticClass:"modal",attrs:{id:"modal","hide-footer":"","hide-header":"",dismissible:""},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[e("div",{staticClass:"modal-content"},[e("div",{staticClass:"modal-header"},[e("b-button",{staticClass:"modal-button close-button",on:{click:t.hideModal}},[t._v(" X ")])],1),e("div",{staticClass:"modal-content-wrapper"},[e("div",{staticClass:"modal-input"},[e("span",[t._v("注释位置 ")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.position,expression:"position"}],attrs:{type:"text",id:"position"},domProps:{value:t.position},on:{input:function(e){e.target.composing||(t.position=e.target.value)}}})]),e("br"),e("div",{staticClass:"modal-input"},[e("span",[t._v("注释内容 ")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],attrs:{type:"text",id:"position"},domProps:{value:t.content},on:{input:function(e){e.target.composing||(t.content=e.target.value)}}})]),e("br"),e("div",{staticClass:"modal-type"},[e("span",[t._v("注释类型 ")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.type,expression:"type"}],attrs:{type:"radio",id:"position"},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.type=e.target.multiple?a:a[0]}}},[e("option",{attrs:{value:"疑点"}},[t._v("疑点")]),e("option",{attrs:{value:"推测"}},[t._v("推测")]),e("option",{attrs:{value:"批注"}},[t._v("批注")])])])]),e("div",{staticClass:"modal-footer"},[e("b-button",{staticClass:"modal-button close-button",on:{click:function(e){return t.addComments()}}},[t._v(" 新建注释 ")])],1)])]),t.showSelectionPanel?e("selection-panel",{attrs:{currentData:t.currentData},on:{showSelectionModal:t.showSelectionModal}}):t._e()],1)},s=[],i=(a(4114),a(417)),o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"dialog",attrs:{id:"dialog"+t.data.id},on:{click:function(e){return t.setChosenContent(t.data.id)}}},[e("span",{staticClass:"role"},[t._v(t._s(t.data.role)+":")]),e("span",{staticClass:"dialog-content"},[t._v(t._s(t.data.content))])])},l=[],r={props:{data:{type:Object,required:!0}},methods:{setChosenContent(t){this.$emit("setChosenContent",t)}}},c=r,m=a(1656),d=(0,m.A)(c,o,l,!1,null,"058936a6",null),h=d.exports,p=a(2804),u=function(){var t=this,e=t._self._c;return e("div",{staticClass:"selectionPanel"},[e("div",{staticClass:"wrapper"},[e("button",{staticClass:"close",on:{click:t.toggle}},[t._v("X")]),e("div",{staticClass:"modal-content"},[e("div",{staticClass:"modal-content-left modal-div"},[t._m(0),e("single-margin",{key:t.currentData.id,attrs:{data:t.currentData,type:t.currentData.type},on:{setChosenMargin:t.nothing,edit:t.nothing,deleteComments:t.nothing}})],1),e("div",{staticClass:"modal-content-middle modal-div"},[t._m(1),e("comments",{on:{add:t.add}})],1),e("div",{staticClass:"modal-content-right modal-div"},[t._m(2),e("div",{staticClass:"comment-list"},[e("ul",t._l(t.temp_comments,(function(a,n){return e("div",{key:n,ref:"margin",refInFor:!0,staticClass:"comment-wrapper",attrs:{id:"comment"+n}},[e("span",[t._v(t._s(a.filename)+":")]),e("single-margin",{attrs:{data:a,type:a.type,filename:a.filename},on:{setChosenMargin:t.nothing,edit:t.notAlter,deleteComments:function(e){return t.deleteAnswer(a)}}})],1)})),0)])])])])])},f=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"title"},[e("span",[t._v("当前批注")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"title"},[e("span",[t._v("所有批注")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"title"},[e("span",[t._v("有关联的批注")])])}],g=a(7285),v={props:{currentData:{type:Object,required:!0}},async created(){await(0,i.A)({url:"http://127.0.0.1:8000/get_answer",params:{target_filename:this.currentData.filename,target_id:this.currentData.id}}).then((t=>this.temp_comments=t.data))},methods:{toggle(){this.$emit("showSelectionModal")},nothing(){},notAlter(){alert("not supported in this panel")},async deleteAnswer(t){await(0,i.A)({url:"http://127.0.0.1:8000/delete_answer",params:{target_filename:this.currentData.filename,target_id:this.currentData.id,answer_filename:t.filename,answer_id:t.id}}),this.temp_comments=this.temp_comments.filter((e=>e.filename!=t.filename&&e.id!=t.id)),await(0,i.A)({url:"http://127.0.0.1:8000/get_answer",params:{target_filename:this.currentData.filename,target_id:this.currentData.id}}).then((t=>this.temp_comments=t.data))},async add(t,e){console.log(t),""!==t&&-1!==e?(await(0,i.A)({url:"http://127.0.0.1:8000/add_answer",params:{target_filename:this.currentData.filename,target_id:this.currentData.id,answer_filename:t,answer_id:e}}),await(0,i.A)({url:"http://127.0.0.1:8000/get_answer",params:{target_filename:this.currentData.filename,target_id:this.currentData.id}}).then((t=>this.temp_comments=t.data))):console.log("answer not valid")}},components:{singleMargin:p.A,comments:g["default"]},data(){return{temp_comments:[]}}},_=v,y=(0,m.A)(_,u,f,!1,null,"fca97f88",null),C=y.exports,w={name:"BaseFind",methods:{async addComments(){console.log(this.type),console.log(typeof this.type),this.toggle(),this.max_id=parseInt(this.max_id)+1,console.log(this.max_id),await(0,i.A)({url:"http://127.0.0.1:8000/add_comments",params:{content:this.content,position:this.position,maxId:this.max_id,type:this.type,filename:this.filename}}),this.show=!1,await this.updateComments()},toggle(){this.show=!this.show},setChosenContent(t){this.chosen_dialog=t},setChosenMargin(t){this.chosen_margin=t},async deleteComments(t){this.comments=this.comments.filter((e=>e.id!=t)),console.log(t),await(0,i.A)({url:"http://127.0.0.1:8000/delete_comments",params:{maxId:t,filename:this.filename}}),await this.updateComments()},async edit(t,e){this.comments.map((a=>{a.id==t&&(a.content=e)})),await(0,i.A)({url:"http://127.0.0.1:8000/edit_comments",params:{id:t,content:e,filename:this.filename}}),await this.updateComments()},async save(){await this.updateComments(),(0,i.A)({url:"http://127.0.0.1:8000/save",params:{filepath:this.filename}})},hideModal(){this.$refs.modal.hide()},async updateComments(){await(0,i.A)({url:"http://127.0.0.1:8000/update_comments",params:{filename:this.filename}}).then((t=>{this.comments=t.data}))},showSelectionModal(t){this.currentData=t,this.showSelectionPanel=!this.showSelectionPanel}},async created(){let t=0;this.max_id=this.comments.length,await(0,i.A)({url:"http://127.0.0.1:8000/get_files",params:{filename:this.filename}}).then((t=>{this.text=t.data})).catch((()=>{this.$router.push("/notfound"),t=1})),1!==t&&await(0,i.A)({url:"http://127.0.0.1:8000/get_comments",params:{filename:this.filename}}).then((t=>{this.comments=t.data})).catch((()=>{this.$router.push("/notfound"),t=1}))},data(){return{text:[],comments:[],model:null,position:0,content:"",max_id:0,show:!1,chosen_dialog:-1,chosen_margin:-1,type:"margin",filename:this.$route.params.path,showSelectionPanel:!1,currentData:{id:-1,type:"疑点"}}},watch:{chosen_dialog(t,e){this.$refs.content.querySelector(`.dialog[id="dialog${t}"]`).classList.add("active-content"),-1!=e&&this.$refs.content.querySelector(`.dialog[id="dialog${e}"]`).classList.remove("active-content"),console.log(this.$refs.content.querySelector(`.dialog[id="dialog${t}"]`))},chosen_margin(t,e){this.$refs.margin.querySelector(`.dialog[id="comment${t}"]`).classList.add("active-margin"),-1!=e&&this.$refs.margin.querySelector(`.dialog[id="comment${e}"]`).classList.remove("active-margin"),console.log(this.$refs.margin.querySelector(`.dialog[id="comment${t}"]`))}},components:{singleDialog:h,singleMargin:p.A,selectionPanel:C}},b=w,x=(0,m.A)(b,n,s,!1,null,"5fa7c33e",null),A=x.exports}}]);
//# sourceMappingURL=310.1bfc00bc.js.map